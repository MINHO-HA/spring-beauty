<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Item">
	
	<!-- 아이템 메뉴를 눌렀을 경우, 검색 -->
	<select id="search" parameterType="Item" resultType="Item">
		SELECT * FROM ITEM
		<where>
			<if test="ITEM_CATEGORY != null">
				ITEM_CATEGORY = #{ITEM_CATEGORY}
			</if>
			<if test="ITEM_NAME != null">
				AND ITEM_NAME LIKE CONCAT('%',#{ITEM_NAME},'%') OR ITEM_BRAND LIKE CONCAT('%',#{ITEM_NAME},'%')
			</if>
		</where>
	</select>
	
	<!-- 아이템 상세 페이지 -->
	<select id="itemDetail" parameterType="int"  resultType="Item">
		SELECT * FROM ITEM WHERE ITEM_ID = #{ITEM_ID}
	</select>
	
	<!-- 아이템 찜 -->
	<insert id="itemStore" parameterType="Store">
		INSERT INTO STORE(MEM_ID, ITEM_ID) VALUES (#{MEM_ID}, #{ITEM_ID})
	</insert>
	
	
	<!-- 메인페이지_(비로그인시)인기 아이템 리스트 -->
	<select id="trendItems" resultType="Item">
		SELECT * FROM ITEM ORDER BY ITEM_ID LIMIT 4
	</select>
	
		<!-- 메인페이지_(로그인시)추천 아이템 리스트 -->
	<select id="personalRecommandItems" parameterType="String" resultType="Item">
		SELECT * FROM ITEM WHERE AGE_ID =(SELECT AGE_ID FROM MEMBER WHERE MEM_ID = #{MEM_ID}) LIMIT 4;
	</select>
	
	
	<!-- 관리자페이지 모든 제품 리스트 -->
	<select id="adminPageItem" parameterType="Item" resultType="Item">
		SELECT * FROM ITEM
	</select>
	
	<!-- 관리자 페이지 제품 등록 -->
	<select id="itemInsert" parameterType="Item">
		INSERT INTO ITEM(ITEM_NAME, ITEM_BRAND, ITEM_CATEGORY, AGE_ID, SKINTYPE_ID, GENDER_ID, ITEM_PRICE, ITEM_IMAGE) VALUES(#{ITEM_NAME}, #{ITEM_BRAND}, #{ITEM_CATEGORY}, #{AGE_ID}, #{SKINTYPE_ID}, #{GENDER_ID}, #{ITEM_PRICE}, #{ITEM_IMAGE})
	</select>
	
	<!-- 관리자 페이지 제품 삭제 -->
	<select id="itemDelete" parameterType="int" resultType="int">
		DELETE FROM ITEM WHERE ITEM_ID = #{ITEM_ID}
	</select>
	
	<!-- 제품 구매시 제품가격*수량  -->
	<update id="itemAmount" parameterType="Basket">
		UPDATE ITEM SET ITEM_PRICE=ITEM_PRICE*#{BASKET_AMOUNT} WHERE ITEM_ID=#{ITEM_ID}
	</update>
	
	<!-- 제품 구매폼 이동시 제품 정보 -->
	<select id="itemInfo" parameterType="int" resultType="Item">
		SELECT * FROM ITEM WHERE ITEM_ID = #{ITEM_ID}
	</select>	
	
	<!-- 제품 구매폼 이동시 구매자 정보 -->
	<select id="memInfo" parameterType="String" resultType="Member">
		SELECT * FROM MEMBER WHERE MEM_ID = #{MEM_ID}
	</select>	
	
	<!-- 마이페이지에서 제품 찜목록보기 -->
	<select id="memberStoredItemList" parameterType="String" resultType="Item">
		SELECT ITEM.ITEM_NAME, ITEM.ITEM_IMAGE, ITEM.ITEM_PRICE FROM ITEM, STORE WHERE STORE.MEM_ID = #{MEM_ID} AND STORE.ITEM_ID = ITEM.ITEM_ID
	</select>
	
</mapper>
